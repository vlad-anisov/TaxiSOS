#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è TDLib –≤ –ø—Ä–æ–µ–∫—Ç–µ SOSTaxi
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./update_tdlib.sh

echo "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ TDLib –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ SOSTaxi..."

# –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
TEMP_DIR="temp_tdlib"
mkdir -p $TEMP_DIR
cd $TEMP_DIR

echo "üì• –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ TDLib..."
# –°–∫–∞—á–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é TDLib
curl -L -o tdlib.zip "https://core.telegram.org/tdlib/tdlib.zip"

if [ $? -eq 0 ]; then
    echo "‚úÖ TDLib —Å–∫–∞—á–∞–Ω —É—Å–ø–µ—à–Ω–æ"
    
    # –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –∞—Ä—Ö–∏–≤
    unzip -q tdlib.zip
    
    echo "üìÅ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∞—Ä—Ö–∏–≤–∞:"
    ls -la
    
    echo "‚ÑπÔ∏è  –î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:"
    echo "1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã .so –∏–∑ –∞—Ä—Ö–∏–≤–∞ –≤ app/src/main/jniLibs/"
    echo "2. –û–±–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ build.gradle"
    echo "3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å API"
    
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ TDLib"
    exit 1
fi

cd ..

echo "üéâ –°–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–ø–∫—É $TEMP_DIR"
echo "üìñ –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ —Ñ–∞–π–ª–µ UPDATE_APP_TO_LOGIN_FIX.md" 